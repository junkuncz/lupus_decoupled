services:
  lupus_decoupled_ce_api.middleware.backendapi:
    class: Drupal\lupus_decoupled_ce_api\BackendApiRequest
    # Note that kernel argument is automatically added for the middleware.
    arguments: ['%lupus_decoupled_ce_api.api_prefix%', '%lupus_decoupled_ce_api.content_format%']
    tags:
      - { name: http_middleware, priority: 150 }
  lupus_decoupled_ce_api.base_url_provider:
    class: Drupal\lupus_decoupled_ce_api\BaseUrlProvider
    arguments: [ '@config.factory', '%lupus_decoupled_ce_api.api_prefix%', '%lupus_decoupled_ce_api.frontend_base_urls%' ]
  lupus_decoupled_ce_api.event_subscriber:
    class: Drupal\lupus_decoupled_ce_api\EventSubscriber\FrontendRedirectSubscriber
    arguments: [ '@config.factory', '%lupus_decoupled_ce_api.frontend_routes%' ]
    tags:
      - { name: event_subscriber }
  lupus_decoupled_ce_api.frontend_path_processor:
    class: Drupal\lupus_decoupled_ce_api\PathProcessor\LupusFrontendPathProcessor
    arguments: [ '%lupus_decoupled_ce_api.frontend_paths%', '@path_alias.manager' ]
    tags:
      - { name: path_processor_outbound, priority: 310 }
  lupus_decoupled_ce_api.preview_path_processor:
    class: Drupal\lupus_decoupled_ce_api\PathProcessor\LupusPreviewPathProcessor
    tags:
      - { name: path_processor_outbound, priority: 500 }
parameters:
  # Allows customizing api prefix per project.
  lupus_decoupled_ce_api.api_prefix: '/ce-api'
  # Sets the content_format of lupus_ce_renderer to json. Also supports 'markup'
  lupus_decoupled_ce_api.content_format: 'json'
  # Allows customizing frontend routes per project.
  lupus_decoupled_ce_api.frontend_routes:
    - entity.node.canonical
  # Allows customizing frontend paths.
  # Todo: Make frontend path processing take frontend routes into account.
  lupus_decoupled_ce_api.frontend_paths:
    - '/node/{node}'
  # For one or more frontend sites that connect to the same backend.
  lupus_decoupled_ce_api.frontend_base_urls: null
