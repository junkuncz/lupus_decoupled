services:
  lupus_decoupled_ce_api.middleware.backendapi:
    class: Drupal\lupus_decoupled_ce_api\BackendApiRequest
    # Note that kernel argument is automatically added for the middleware.
    arguments: ['%lupus_decoupled_ce_api.lupus_decoupled_ce_api_prefix%']
    tags:
      - { name: http_middleware, priority: 150 }
  lupus_decoupled_ce_api.base_url_provider:
    class: Drupal\lupus_decoupled_ce_api\BaseUrlProvider
    arguments: [ '@config.factory', '%lupus_decoupled_ce_api.lupus_decoupled_ce_api_prefix%' ]
  lupus_decoupled_ce_api.event_subscriber:
    class: Drupal\lupus_decoupled_ce_api\EventSubscriber\FrontendRedirectSubscriber
    arguments: [ '@config.factory', '%lupus_decoupled_ce_api.frontend_routes%' ]
    tags:
      - { name: event_subscriber }
  lupus_decoupled_ce_api.frontend_path_processor:
    class: Drupal\lupus_decoupled_ce_api\PathProcessor\LupusFrontendPathProcessor
    arguments: [ '%lupus_decoupled_ce_api.frontend_paths%', '@path_alias.manager' ]
    tags:
      - { name: path_processor_outbound, priority: 310 }
parameters:
  # Parameter that allows customizing api prefix per project.
  lupus_decoupled_ce_api.lupus_decoupled_ce_api_prefix: '/ce-api'
  # Parameter that allows customizing frontend routes per project.
  lupus_decoupled_ce_api.frontend_routes:
    - entity.node.canonical
  # Todo: Make frontend path processing work from the routes also.
  lupus_decoupled_ce_api.frontend_paths:
    - '/node/{node}'
